<launch>
  <arg name="fcu_url"/>
  <arg name="auto_arm" default="false"/>
  <arg name="auto_offboard" default="false"/>
  <arg name="setpoint_subscription_topic" default="fluid/setpoint"/>
  <arg name="setpoint_publish_topic" default="mavros/setpoint_raw/local"/>
  <arg name="launch_reconfigure" default="false"/>
  <arg name="launch_rviz" default="true"/>

  <rosparam command="load" file="$(find fluid)/params.yaml" />

  <param name="auto_arm" value="$(arg auto_arm)"/>
  <param name="auto_offboard" value="$(arg auto_offboard)"/>

  <node name="path_publisher" pkg="fluid" type="path_publisher.py" output="screen"/>

  <node name="world_to_map_transform_publisher"       pkg="tf" type="static_transform_publisher" args="0 0 0 0 0 0 1 world map 10"/>
  <node name="world_to_base_link_transform_publisher" pkg="tf" type="static_transform_publisher" args="0 0 0 0 0 0 1 world base_link 10"/>
  <node name="world_to_odom_transform_publisher"      pkg="tf" type="static_transform_publisher" args="0 0 0 0 0 0 1 world odom 10"/>

  <node name="fluid_server" pkg="fluid" type="server" output="screen" args="$(arg setpoint_subscription_topic)"/>
  <node name="setpoint_publisher" pkg="fluid" type="setpoint_publisher" output="screen" args="$(arg setpoint_subscription_topic) $(arg setpoint_publish_topic)"/>

  <include file="$(find mavros)/launch/px4.launch">
    <arg name="fcu_url" value="$(arg fcu_url)"/>
    <arg name="log_output" value="log"/>
    <arg name="tgt_system" value="1"/>
    <arg name="tgt_component" value="1"/>
  </include>

  <node if="$(arg launch_reconfigure)" type="rqt_reconfigure" name="rqt_reconfigure" pkg="rqt_reconfigure"/>
  <node if="$(arg launch_rviz)" type="rviz" name="rviz" pkg="rviz" args="-d $(find fluid)/rviz_configs/fluid.rviz" />

</launch>
